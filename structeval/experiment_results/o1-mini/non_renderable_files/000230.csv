
import csv
import uuid

def generate_recipe_csv(recipe):
    fieldnames = [
        'recipe_id',
        'recipe_name',
        'chef_name',
        'cuisine_type',
        'difficulty_level',
        'prep_time_minutes',
        'cook_time_minutes',
        'servings',
        'ingredients_list',
        'ingredients_count',
        'main_ingredient',
        'steps_list',
        'steps_count',
        'nutrition_calories',
        'nutrition_protein_grams',
        'nutrition_fat_grams',
        'nutrition_carbs_grams'
    ]
    
    # Generate unique recipe_id
    recipe_id = str(uuid.uuid4())
    
    # Prepare CSV row data
    row = {
        'recipe_id': recipe_id,
        'recipe_name': recipe.get('recipe_name', ''),
        'chef_name': recipe.get('chef_name', 'Unknown'),
        'cuisine_type': recipe.get('cuisine_type', ''),
        'difficulty_level': recipe.get('difficulty_level', ''),
        'prep_time_minutes': int(recipe.get('prep_time_minutes', 0)),
        'cook_time_minutes': int(recipe.get('cook_time_minutes', 0)),
        'servings': int(recipe.get('servings', 1)),
        'ingredients_list': ';'.join(recipe.get('ingredients', [])),
        'ingredients_count': len(recipe.get('ingredients', [])),
        'main_ingredient': recipe.get('main_ingredient', ''),
        'steps_list': ';'.join(recipe.get('steps', [])),
        'steps_count': len(recipe.get('steps', [])),
        'nutrition_calories': int(recipe.get('nutrition_calories', 0)),
        'nutrition_protein_grams': int(recipe.get('nutrition_protein_grams', 0)),
        'nutrition_fat_grams': int(recipe.get('nutrition_fat_grams', 0)),
        'nutrition_carbs_grams': int(recipe.get('nutrition_carbs_grams', 0))
    }
    
    # Write to CSV
    with open('recipes.csv', 'a', newline='', encoding='utf-8') as csvfile:
        writer = csv.DictWriter(csvfile, fieldnames=fieldnames)
        
        # Write header if file is empty
        csvfile.seek(0, 2)  # Move to end of file
        if csvfile.tell() == 0:
            writer.writeheader()
        
        writer.writerow(row)

# Example usage
recipe_description = {
    'recipe_name': 'Spaghetti Carbonara',
    'chef_name': 'Gordon Ramsay',
    'cuisine_type': 'Italian',
    'difficulty_level': 'Medium',
    'prep_time_minutes': 15,
    'cook_time_minutes': 20,
    'servings': 4,
    'ingredients': ['spaghetti', 'eggs', 'parmesan cheese', 'pancetta', 'black pepper'],
    'main_ingredient': 'spaghetti',
    'steps': [
        'Boil spaghetti.',
        'Cook pancetta until crispy.',
        'Beat eggs and mix with cheese.',
        'Combine spaghetti with pancetta and remove from heat.',
        'Quickly mix in egg and cheese mixture.',
        'Season with black pepper and serve.'
    ],
    'nutrition_calories': 500,
    'nutrition_protein_grams': 20,
    'nutrition_fat_grams': 25,
    'nutrition_carbs_grams': 50
}

generate_recipe_csv(recipe_description)
