
import csv
import re
from datetime import datetime

def extract_species_data(description):
    data = {}
    # Define patterns for each field
    patterns = {
        'species_id': r'Species ID:\s*([A-Za-z0-9]+)',
        'species_name': r'Scientific Name:\s*([A-Za-z\s]+)',
        'classification': r'Classification:\s*([A-Za-z]+)',
        'habitat_type': r'Habitat Type:\s*([A-Za-z]+)',
        'average_lifespan_years': r'Average Lifespan:\s*(\d+)\s*years',
        'discovery_date': r'Discovery Date:\s*(\d{4}-\d{2}-\d{2})',
        'is_endangered': r'Endangered:\s*(TRUE|FALSE)',
        'average_height_cm': r'Average Height:\s*(\d+(\.\d+)?)\s*cm',
        'diet': r'Diet:\s*([A-Za-z]+)',
        'origin_planet': r'Origin Planet:\s*([A-Za-z]+)',
        'notable_traits': r'Notable Traits:\s*([^;]+(?:;[^;]+)*)',
        'first_observed_by': r'First Observed By:\s*([A-Za-z\s]+)',
        'color_variations': r'Color Variations:\s*([^;]+(?:;[^;]+)*)',
        'reproduction_method': r'Reproduction Method:\s*([A-Za-z]+)',
        'population_estimate': r'Population Estimate:\s*(\d+)'
    }

    for field, pattern in patterns.items():
        match = re.search(pattern, description, re.IGNORECASE)
        if match:
            data[field] = match.group(1).strip()
        else:
            data[field] = ''

    # Convert types
    data['average_lifespan_years'] = int(data['average_lifespan_years']) if data['average_lifespan_years'].isdigit() else ''
    data['average_height_cm'] = float(data['average_height_cm']) if re.match(r'^\d+(\.\d+)?$', data['average_height_cm']) else ''
    data['population_estimate'] = int(data['population_estimate']) if data['population_estimate'].isdigit() else ''
    data['discovery_date'] = data['discovery_date'] if re.match(r'^\d{4}-\d{2}-\d{2}$', data['discovery_date']) else ''

    # Write to CSV
    fieldnames = [
        'species_id',
        'species_name',
        'classification',
        'habitat_type',
        'average_lifespan_years',
        'discovery_date',
        'is_endangered',
        'average_height_cm',
        'diet',
        'origin_planet',
        'notable_traits',
        'first_observed_by',
        'color_variations',
        'reproduction_method',
        'population_estimate'
    ]

    with open('species_data.csv', 'a', newline='') as csvfile:
        writer = csv.DictWriter(csvfile, fieldnames=fieldnames)
        # Uncomment the next line if writing header for the first time
        # writer.writeheader()
        writer.writerow(data)

# Example usage
description = """
Species ID: XJ12A
Scientific Name: Zorblattus magnificus
Classification: Reptile
Habitat Type: Terrestrial
Average Lifespan: 250 years
Discovery Date: 2023-08-15
Endangered: TRUE
Average Height: 150.5 cm
Diet: Omnivore
Origin Planet: Xebulon
Notable Traits: Scales;Multiple Eyes;Regeneration
First Observed By: Dr. Jane Doe
Color Variations: Green;Blue;Red
Reproduction Method: Viviparous
Population Estimate: 5000
"""

extract_species_data(description)
