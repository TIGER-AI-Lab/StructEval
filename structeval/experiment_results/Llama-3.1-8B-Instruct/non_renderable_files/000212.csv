
import csv
import re

def extract_species_info(text):
    species_id = str(len(species_dict) + 1)
    common_name = re.search(r'common name: (.*)', text).group(1).strip()
    scientific_name = re.search(r'scientific name: (.*)', text).group(1).strip()
    classification = re.search(r'classification: (.*)', text, re.DOTALL).group(1).strip()
    classification = classification.split('
')
    kingdom = classification[0].strip()
    phylum = classification[1].strip()
    class_ = classification[2].strip()
    order = classification[3].strip()
    family = classification[4].strip()
    genus = classification[5].strip()
    habitat = re.search(r'habitat: (.*)', text, re.DOTALL).group(1).strip()
    habitat = habitat.split('
')
    primary_habitat = habitat[0].strip()
    secondary_habitat = habitat[1].strip() if len(habitat) > 1 else ''
    distribution = re.search(r'distribution: (.*)', text, re.DOTALL).group(1).strip()
    distribution = distribution.split('
')
    continent = distribution[0].strip()
    countries = distribution[1].strip()
    conservation_status = re.search(r'conservation status: (.*)', text, re.DOTALL).group(1).strip()
    conservation_status = conservation_status.split('
')
    iucn = conservation_status[0].strip()
    population_trend = conservation_status[1].strip()
    notable_features = re.search(r'notable features: (.*)', text, re.DOTALL).group(1).strip()
    average_lifespan_years = re.search(r'average lifespan: (\d+) years', text).group(1)
    diet = re.search(r'diet: (.*)', text).group(1).strip()
    return {
        'species_id': species_id,
        'common_name': common_name,
        'scientific_name': scientific_name,
        'classification.kingdom': kingdom,
        'classification.phylum': phylum,
        'classification.class': class_,
        'classification.order': order,
        'classification.family': family,
        'classification.genus': genus,
        'habitat.primary': primary_habitat,
        'habitat.secondary': secondary_habitat,
        'distribution.continent': continent,
        'distribution.countries': countries,
        'conservation_status.iucn': iucn,
        'conservation_status.population_trend': population_trend,
        'notable_features': notable_features,
        'average_lifespan_years': int(average_lifespan_years),
        'diet': diet
    }

species_dict = {}
with open('species_data.csv', 'w', newline='') as csvfile:
    fieldnames = ['species_id', 'common_name', 'scientific_name', 'classification.kingdom', 'classification.phylum', 'classification.class', 'classification.order', 'classification.family', 'classification.genus', 'habitat.primary', 'habitat.secondary', 'distribution.continent', 'distribution.countries', 'conservation_status.iucn', 'conservation_status.population_trend', 'notable_features', 'average_lifespan_years', 'diet']
    writer = csv.DictWriter(csvfile, fieldnames=fieldnames)
    writer.writeheader()
    with open('species_text.txt', 'r') as textfile:
        for line in textfile:
            species_dict.update(extract_species_info(line))
            writer.writerow(species_dict[species_dict['species_id']])
